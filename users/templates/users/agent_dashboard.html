<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: #faf5ff;
    }
    
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
    }
    
    .status-pending {
      background-color: #fef3c7;
      color: #92400e;
    }
    
    .status-confirmed {
      background-color: #d1fae5;
      color: #065f46;
    }
    
    .status-completed {
      background-color: #dbeafe;
      color: #1e40af;
    }

    .action-button {
      background-color: #8b5cf6;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: background-color 0.2s;
    }

    .action-button:hover {
      background-color: #7c3aed;
    }

    .action-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .cancel-button {
      background-color: #ef4444;
    }

    .cancel-button:hover {
      background-color: #dc2626;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app" class="min-h-full"></div>
  <script>
    // Sample data structure - replace this with your actual database data
    let allBookings = [
      // Example booking structure:
      // {
      //   id: "1",
      //   client_name: "John Doe",
      //   client_email: "john@example.com",
      //   client_phone: "(555) 123-4567",
      //   property_address: "123 Main St, City",
      //   appointment_date: "2024-01-15",
      //   appointment_time: "10:00 AM",
      //   booking_status: "pending", // pending, confirmed, or completed
      //   created_at: "2024-01-10T12:00:00Z"
      // }
    ];

    function renderDashboard() {
      const app = document.getElementById('app');
      
      // Sort bookings by date
      const sortedBookings = [...allBookings].sort((a, b) => {
        const dateA = new Date(a.appointment_date + ' ' + a.appointment_time);
        const dateB = new Date(b.appointment_date + ' ' + b.appointment_time);
        return dateB - dateA;
      });

      const totalBookings = sortedBookings.length;
      const pendingCount = sortedBookings.filter(b => b.booking_status === 'pending').length;
      const confirmedCount = sortedBookings.filter(b => b.booking_status === 'confirmed').length;

      app.innerHTML = `
        <div style="background-color: #faf5ff; min-height: 100%; padding: 2rem;">
          <div style="max-width: 1200px; margin: 0 auto;">
            <!-- Header -->
            <div style="margin-bottom: 2rem;">
              <h1 style="font-size: 2rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">
                My Bookings
              </h1>
              <p style="font-size: 1.125rem; color: #1f2937; opacity: 0.7;">
                Welcome back!
              </p>
            </div>

            <!-- Stats Overview -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
              <div style="background-color: #ffffff; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="font-size: 2rem; font-weight: 700; color: #8b5cf6;">${totalBookings}</div>
                <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.7; margin-top: 0.25rem;">Total Bookings</div>
              </div>
              <div style="background-color: #ffffff; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="font-size: 2rem; font-weight: 700; color: #8b5cf6;">${pendingCount}</div>
                <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.7; margin-top: 0.25rem;">Pending</div>
              </div>
              <div style="background-color: #ffffff; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="font-size: 2rem; font-weight: 700; color: #8b5cf6;">${confirmedCount}</div>
                <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.7; margin-top: 0.25rem;">Confirmed</div>
              </div>
            </div>

            <!-- Bookings List -->
            <div id="bookings-container">
              ${sortedBookings.length === 0 ? `
                <div style="background-color: #ffffff; padding: 3rem; border-radius: 0.75rem; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“…</div>
                  <div style="font-size: 1.125rem; color: #1f2937; opacity: 0.7;">No bookings yet</div>
                </div>
              ` : sortedBookings.map(booking => `
                <div class="booking-card" style="background-color: #ffffff; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                    <div>
                      <div style="font-size: 1.25rem; font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">
                        ${booking.client_name}
                      </div>
                      <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.7;">
                        ${formatDateTime(booking.appointment_date, booking.appointment_time)}
                      </div>
                    </div>
                    <span class="status-badge status-${booking.booking_status}">
                      ${booking.booking_status.charAt(0).toUpperCase() + booking.booking_status.slice(1)}
                    </span>
                  </div>

                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                      <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.6; margin-bottom: 0.25rem;">Email</div>
                      <div style="font-size: 1rem; color: #1f2937;">${booking.client_email}</div>
                    </div>
                    <div>
                      <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.6; margin-bottom: 0.25rem;">Phone</div>
                      <div style="font-size: 1rem; color: #1f2937;">${booking.client_phone}</div>
                    </div>
                    <div>
                      <div style="font-size: 0.875rem; color: #1f2937; opacity: 0.6; margin-bottom: 0.25rem;">Property</div>
                      <div style="font-size: 1rem; color: #1f2937;">${booking.property_address}</div>
                    </div>
                  </div>

                  ${booking.booking_status === 'pending' ? `
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                      <button class="action-button" onclick="updateBookingStatus('${booking.id}', 'confirmed')">
                        Confirm Booking
                      </button>
                      <button class="action-button cancel-button" onclick="deleteBooking('${booking.id}')">
                        Cancel
                      </button>
                    </div>
                  ` : booking.booking_status === 'confirmed' ? `
                    <button class="action-button" onclick="updateBookingStatus('${booking.id}', 'completed')">
                      Mark as Completed
                    </button>
                  ` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function formatDateTime(date, time) {
      const dateObj = new Date(date);
      const options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
      return `${dateObj.toLocaleDateString('en-US', options)} at ${time}`;
    }

    // CONNECT TO YOUR DATABASE HERE
    // Replace these functions with your actual database API calls
    
    async function loadBookingsFromDatabase() {
      // TODO: Replace with your actual API call
      // Example:
      // const response = await fetch('YOUR_API_ENDPOINT/bookings');
      // const data = await response.json();
      // allBookings = data;
      // renderDashboard();
      
      console.log('Load bookings from your database here');
    }

    async function updateBookingStatus(bookingId, newStatus) {
      const button = event.target;
      button.disabled = true;
      button.textContent = 'Updating...';

      // TODO: Replace with your actual API call
      // Example:
      // const response = await fetch(`YOUR_API_ENDPOINT/bookings/${bookingId}`, {
      //   method: 'PUT',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ booking_status: newStatus })
      // });
      
      // For now, update locally
      const booking = allBookings.find(b => b.id === bookingId);
      if (booking) {
        booking.booking_status = newStatus;
        renderDashboard();
      }

      console.log(`Update booking ${bookingId} to status: ${newStatus}`);
    }

    async function deleteBooking(bookingId) {
      const button = event.target;
      button.disabled = true;
      button.textContent = 'Cancelling...';

      // TODO: Replace with your actual API call
      // Example:
      // const response = await fetch(`YOUR_API_ENDPOINT/bookings/${bookingId}`, {
      //   method: 'DELETE'
      // });
      
      // For now, delete locally
      allBookings = allBookings.filter(b => b.id !== bookingId);
      renderDashboard();

      console.log(`Delete booking ${bookingId}`);
    }

    // Initialize the dashboard
    renderDashboard();
    loadBookingsFromDatabase();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99c6e3b64072b294',t:'MTc2Mjc5MTc1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>